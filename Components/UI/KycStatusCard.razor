@using P4LicensePortal.Models

<MudCard Elevation="3" Class="h-100">
    <MudCardHeader>
        <CardHeaderContent>
            <MudText Typo="Typo.h6">KYC Status</MudText>
        </CardHeaderContent>
        <CardHeaderActions>
            @if (KycProfile != null && KycProfile.IsVerified)
            {
                <MudChip Color="Color.Success" Size="Size.Small">Verified</MudChip>
            }
            else if (KycProfile != null && KycProfile.Status == "Pending")
            {
                <MudChip Color="Color.Warning" Size="Size.Small">Pending</MudChip>
            }
            else if (KycProfile != null && KycProfile.IsExpired)
            {
                <MudChip Color="Color.Error" Size="Size.Small">Expired</MudChip>
            }
            else
            {
                <MudChip Color="Color.Error" Size="Size.Small">Not Verified</MudChip>
            }
        </CardHeaderActions>
    </MudCardHeader>
    <MudCardContent>
        @if (KycProfile != null)
        {
            <MudList Clickable="false" Dense="true">
                <MudListItem>
                    <MudText Typo="Typo.body2"><b>Company:</b> @KycProfile.CompanyName</MudText>
                </MudListItem>
                <MudListItem>
                    <MudText Typo="Typo.body2"><b>Tax ID:</b> @KycProfile.TaxId</MudText>
                </MudListItem>
                <MudListItem>
                    <MudText Typo="Typo.body2"><b>Contact:</b> @KycProfile.ContactName</MudText>
                </MudListItem>
                @if (KycProfile.VerificationDate.HasValue)
                {
                    <MudListItem>
                        <MudText Typo="Typo.body2"><b>Verified:</b> @KycProfile.VerificationDate.Value.ToString("yyyy-MM-dd")</MudText>
                    </MudListItem>
                }
                @if (KycProfile.ExpiryDate.HasValue)
                {
                    <MudListItem>
                        <MudText Typo="Typo.body2" Color="@(KycProfile.IsExpired ? "error" : "")">
                            <b>Expires:</b> @KycProfile.ExpiryDate.Value.ToString("yyyy-MM-dd")
                            @if (KycProfile.IsExpired)
                            {
                                <span> (Expired)</span>
                            }
                            else if (KycProfile.ExpiryDate.Value < DateTime.UtcNow.AddDays(30))
                            {
                                <span> (Renew Soon)</span>
                            }
                        </MudText>
                    </MudListItem>
                }
            </MudList>

            @if (KycProfile.Status == "Rejected")
            {
                <MudAlert Severity="Severity.Error" Class="mt-3">
                    @KycProfile.RejectionReason
                </MudAlert>
            }
            else if (KycProfile.IsExpired)
            {
                <MudAlert Severity="Severity.Warning" Class="mt-3">
                    Your KYC verification has expired. Please renew it to continue accessing all features.
                </MudAlert>
            }
            else if (KycProfile.ExpiryDate.HasValue && KycProfile.ExpiryDate.Value < DateTime.UtcNow.AddDays(30))
            {
                <MudAlert Severity="Severity.Info" Class="mt-3">
                    Your KYC verification will expire soon. Please renew it before expiration.
                </MudAlert>
            }
        }
        else
        {
            <MudAlert Severity="Severity.Warning">
                KYC verification is required. Please complete your profile.
            </MudAlert>
        }
    </MudCardContent>
    <MudCardActions>
        @if (KycProfile == null || KycProfile.IsExpired)
        {
            <MudButton Variant="Variant.Filled" Color="Color.Primary" Href="/kyc/verify">
                @(KycProfile == null ? "Complete KYC" : "Renew KYC")
            </MudButton>
        }
        else if (KycProfile.Status == "Pending")
        {
            <MudButton Variant="Variant.Outlined" Color="Color.Default" Disabled="true">
                Verification Pending
            </MudButton>
        }
        else
        {
            <MudButton Variant="Variant.Text" Color="Color.Primary" Href="/kyc/details">
                View Details
            </MudButton>
        }
    </MudCardActions>
</MudCard>

@code {
    [Parameter]
    public KycProfile KycProfile { get; set; }
}
